# Tool 1 version `5.3.0`

This is a minor version introducing support for Spanish.

## User Visible Changes

* Tool 1 is now available in Spanish. Many thanks to
  [Maximiliano Simaz](https://www.linkedin.com/in/msimaz/), who kindly provided
  all translations, and to
  [Claudia-Alejandra Jaramillo](https://www.linkedin.com/in/claudia-alejandra-jaramillo-67993058/),
  who thoroughly reviewed them.

## Server Changes

None.

## Fixes

* `read_collaborators()` now handles null (`~`) `Profile` and `Email` fields in
  `i18n/_collaborators.yml`. The latter is replaced by em dashes (`â€”`) if null.
  This is useful to avoid including personal information without obtaining an
  explicit consent from the collaborators first. Fields `Role` and `Name` are
  always required.

# Tool 1 version `5.2.0`

This is a minor version that packs many internal changes on the backend side.

## User Visible Changes

* There is a new section listing external collaborators who worked on
  translations in the FAQ modal.

* The source text (and underlying translations) received minor updates.

## Server Changes

* The required logic and functions (`ordinal_rules_spanish()`) to support
  Spanish is implemented. Translations are also available internally, but
  since they are still being reviewed, they will be released soon in the
  next version.

  * Many thanks to [Maximiliano Simaz](https://www.linkedin.com/in/msimaz/)
    who kindly provided all translations.

* `.Rprofile`, `app.R`, and all scripts stored in `R/` were renamed and/or
  reorganized. The new structure should be easier to comprehend and navigate (hopefully!).

* Reactive values were all renamed and refactored.

* Constants were removed. Only `tr`, `urls`, and `tags` are still used.
  Other constants were either removed or refactored into R options.

  * Options are defined in `.Rprofile` and scoped to the underlying R process.

* Remaining global constants are now defined in `R/zzz.R` to ensure they are
  always sourced last.

* New introspector functions `is_lgl1()`, `is_int1()`, and `is_chr()`.

* New formatting function `as_interval()`.

* New `match_arg()` function. This is an alternative to `base::match.arg()`
  that is better suited for Tool 1.

* There is a new Head static module (`ui_head()`). It encapsulates the contents
  of the `<head>` of Tool 1.

  * Many new `<meta>` tags were added.

* New `i18n_url` S3 class. Instances of this class represent translatable URLs.
  They are created with `i18n_url()` and has methods for `[`, `format()`, and
  `print()`.

* Metadata used to describe AIHA risk levels are now encapsulated into
  three functions: `get_risk_level_colors()`, `get_risk_level_thresholds()`,
  and `get_risk_level_info()`.

* Static tables are now generated by `as_html_table()`, a S3 generic function
  designed to create static HTML tables from R objects (more easily). There is
  currently one method defined for `data.frame` objects. The objective is
  twofold.

  1. Avoid complex mechanisms and packages (like `DT`) when appropriate.

  2. Style tables using CSS (Bootstrap) classes.

* New `i18n/_collaborators.yml` file listing external collaborators who worked
  on translations in the FAQ modal. There is also a new `read_collaborators()`
  to safely read it and format it into a `data.frame` object.

* The `intl` prefix used throughout the code base for internationalization was
  changed to `i18n`.

* The default value of `lang` arguments is now always hardcoded and set equal
  to `en`. This is because the source language will never change.

  * This does not apply to arguments expecting `shiny::reactive()` objects.

* The code documentation was significantly updated and partially rewritten.

* Development functions were simplified. Many arguments were replaced by
  internal calls to `getOption()`.

* Other minor miscellaneous changes. They were made for better readability,
  consistency, and optimization purposes.

* Instructions for translators were updated with new instructions.

## Fixes

* Fixed some grammar inconsistencies. Some names are now treated as proper
  nouns. Others (like Tool 1) are considered to be untranslatable.

# Tool 1 version `5.1.0`

This version is a massive milestone for Expostats as it becomes the official
version of Tool 1 and Tool 1 Express (it is now *out of beta*).

## User Visible Changes

* Tool 1 is now available in French.

* The source text was reviewed and rewritten for consistency and simplicity.
  Notably, the abbrevation OEL is now always used for brevity and clarity.

* Fixed incorrect descriptions of the Exceedance Plot's variants.

* Mode names were revamped: `default` is now Extended and `simplified` is now
  Express. Labels were renamed accordingly.

* The default mode is now Express (Tool 1 Express).

* There is a new optional input in Extended mode: Occupational Exposure Limit
  Multiplier. Use this value to modify the OEL with an arbitrary multiplier.
  The resulting product of these values will be used as the effective OEL in
  all subsequent calculations and analyses.

* Panels now have a title bar showing the current mode and the panel's
  underlying name.

* The footer of the sidebar and the FAQ panel was rearranged and updated.

* The contents of the FAQ panel got a lot of small updates.

* Latest changes (this document) are now natively accessible from Tool 1.
  GitHub is no longer needed.

## Server Changes

* Many small tweaks and optimizations were introduced to ease the translation
  process.

* The Simplified Mode Inference Panel Module was renamed to Express Mode
  Inference Panel Module. Functions, scripts, and identifiers were changed
  accordingly.

* The `README` now contains clear instructions to follow when adding a new
  supported language.

* `ui_element()` is removed.

* `ui_link()` and `ui_link_mailto()` were rewritten (fixing a lof of bugs and
  problems that would arise when they were integrated into the source text with
  `html()`).

* All `server_panel_*()` functions now returns a `shiny::reactive()` object
  that can be called to get the panel's underlying title.

* All development scripts now encapsulate their logic into proper functions
  (`.find()`, `.pub()`, and `.run()`). The `.Rprofile` script was modified
  accordingly.

* Script `.scripts/publish.R` now generates static HTML files from `NEWS.md`
  and `i18n/README.md`. These are stored in `www/assets/` and served under
  path `/assets`.

* There is a new `README.md` in `i18n/`detailing what external collaborators
  working on translations must do.

* `.pub()` (script `.scripts/publish.R`) now generates assets HTML files
  `www/assets/translations.html` and `www/assets/news.html` from
  source files `i18n/README.md` and `NEWS.md` respectively. YAML headers
  are not included in the Markdown files because they are rendered as
  ugly HTML tables by GitHub.

## Fixes

* Fixed a logical error in development script `find-text.R` that would discard
  existing translations stored in `i18n/` without reusing them.

* Fixed some pieces of text that were not wrapped in `translate()` calls.

* Fixed rare annoying edge cases by forcing `html()` to explicitly convert
  elements passed to `...` to character strings instead of deferring this
  operation to `sprintf()`.

* Fixed a bug in the Exceedance Plot Sidebar Module where input
  `col_bg_threshold` was hidden for `plot3` (which was wrong).

* Fixed incorrect descriptions and labels in the Exceedance Plot Module.

# Tool 1 version `5.0.0`

This major version introduces Tool 1 Express (Simplified) directly into Tool 1.
The former was rewritten during the process. All existing functionalities were
preserved.

## User Visible Changes

* The user interface can now be customized via query parameters (included in
  the URL).

* The Title Bar was revamped bringing new modes: default or simplified.

* There is a new Statistical Panel for the new simplified mode.

* There is now additional information on the treatment of non-detects in the
  Frequently Asked Questions.

* There is now additional information on how Tool 1 can be used and how it
  works (behind the scenes) in the Frequently Asked Questions.

* The vocabulary used inside Estimates cards was shortened.

* Risk Band plots use the latest AIHA color scheme.

* Inference panels were renamed to Statistical Inference panels.

* French is temporarily removed from the list of officially supported languages.
  It will be reintroduced in the next version (`5.1.0`).

* Many superfluous external links were removed. We now try to only add links in
  the Frequently Asked Questions (unless it really matters elsewhere).

* Some icons used for decoration purposes only were removed. Others were
  standardized (their usage).

* Many smaller cosmetic changes were introduced (mostly for consistence and
  ease of use).

## Server Changes

* The logic of `server()` was revamped prior to the introduction of application
  modes, UI parameters, and the Simplified Mode Inference Panel Module.

* The Title Bar module was revamped following the introduction of *modes*.

* The Sidebar module was updated following the introduction of the Simplified
  Mode Inference Panel Module. Spaces between elements was standardized and
  buttons were reimplemented.

* Generic `<span>` and `<div>` containers used only to make the text **bold**
  or **italic** were replaced by tags such as `<em>` and `<strong>`. This
  simplifies the code.

* Various global constants were updated. Some were removed.

* Constants `default_simplified_inputs` and `aiha_risk_levels` were added. The
  latter introduces the new AIHA naming convention for discrete risk levels.
  All panels were updated accordingly. Notably, all `risk_assessment()` reactive
  values were rewritten. Observers and outputs that depend on them were updated.

* Various new helper functions were added following changes to the Title Bar
  and Sidebar modules. Some of them ease the management of the UI state.

* All calls to `translate()` were removed from observers and refactored into
  reactive values that can be cached with `shiny::bindCache()`. These values
  are passed to `update_*()` functions called inside `shiny::observe()`. This
  yields a significant performance boost. This was worth it even if working
  with a large number of `shiny::reactive()` calls can sometimes be cumbersome.

* More outputs are now cached with `shiny::bindCache()` to increase performance.

* Some inputs of the Sidebar module were renamed.

* The code was partially restyled. Notably, the usage of space was reduced
  to improve readability.

* Many new code comments and documentation block were added.

* Further smaller changes.

## Fixes

* Many grammar errors and typos were fixed.

* Percentages were incorrectly used as units in the Percentiles and Arithmetic
  Mean panels.

* The parent container of the Sidebar's warning card is now hidden as a whole
  when the Submit button is clicked (instead of just the card itself).

* Shiny's auto-reload feature was removed. Its broken state was breaking
  functionalities of Tool 1 in development environments.

* Various smaller bugs were fixed.

# Tool 1 version `4.1.0`

## User Visible Changes

* Tool 1 is now mobile-friendly and should work with a wide variety of screens,
  including smaller ones. A minimum width of `400` pixels is strongly
  recommended.

* The title bar is now slightly smaller, and has more intuitive buttons with
  text labels.

* This changelog is now accessible directly from a link included in the footer
  of the Calculation Parameters sidebar and Frequently Asked Questions modal.

## Server Changes

* The implementation of `ui_title()` was revamped and optimized. The objective
  was to create a responsive Title Bar module leveraging
  [Bootrap 5 Navbar classes](https://getbootstrap.com/docs/5.3/components/navbar/).

* The implementation of `server_title()` is now a little bit faster. The number
  of times `bslib::update_tooltip()` is called has been reduced. All outputs
  are cached.

* Development script `R/publish.R` was refactored into a `publish()` function.
  It can either publish a development version or an official version of Tool 1.
  See `README.md` for details.

* Some application-level observers (defined in `app.R`) are now executed once
  and discarded afterwards.

* Attribute `lang` of the root `<html>` element and the window's title (the
  browser's tab name) are now only updated if `lang` is not equal to the
  default language. Doing so yields faster loading times.

## Fixes

* Estimates boxes now properly overflow vertically as a whole (with only one
  scrollbar) and not as two separate elements. The latter was confusing on
  smaller screens.

* Message boxes included in the Calculation Parameters sidebar now properly
  grow and shrink on all screens. They no longer collapse to a single line
  with a width equal to `2px` (top and bottom borders).

# Tool 1 version `4.0.0`

This major version is a complete redesign of Tool 1. It was entirely rewritten
except for core scientific back-end components. They were left nearly as is in
the source code.
